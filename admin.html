<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin ‚Äî Saboplume</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=EB+Garamond:ital,wght@0,400;0,500&family=Cormorant+Garamond:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
<style>
:root{--br:#7B2D00;--brf:#5A1F00;--vt:#3B5E2B;--vtf:#2D4A20;--cr:#F5F2EC;--tx:#2C2C2C;--or:#C8A96E}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:"EB Garamond",Georgia,serif;background:#f0ede8;color:var(--tx);min-height:100vh}
.login-wrap{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
.login-box{background:#fff;padding:48px 42px;max-width:400px;width:100%;text-align:center;box-shadow:0 4px 24px rgba(0,0,0,.08)}
.login-box h1{font-family:"Cormorant Garamond",serif;font-style:italic;font-size:36px;color:var(--vt);margin-bottom:6px}
.login-box p{font-size:14px;color:#999;font-family:"Cinzel",serif;letter-spacing:.1em;margin-bottom:30px}
.linp{width:100%;padding:13px 16px;border:1.5px solid #ddd;background:var(--cr);font-family:"EB Garamond",serif;font-size:17px;color:#444;margin-bottom:13px;outline:none}
.linp:focus{border-color:var(--vt)}
.lbtn{width:100%;background:var(--vt);color:#fff;border:none;padding:14px;font-family:"Cinzel",serif;font-size:12px;letter-spacing:.12em;cursor:pointer}
.lbtn:hover{background:var(--vtf)}
.lerr{color:#c00;font-size:14px;margin-top:8px;display:none}
.admin-wrap{display:none;min-height:100vh}
.sidebar{position:fixed;top:0;left:0;width:240px;height:100vh;background:var(--br);overflow-y:auto;padding:0;z-index:100}
.sidebar-logo{padding:24px 24px 16px;border-bottom:1px solid rgba(255,255,255,.15)}
.sidebar-logo h2{font-family:"Cormorant Garamond",serif;font-style:italic;font-size:24px;color:#fff}
.sidebar-logo p{font-family:"Cinzel",serif;font-size:9px;letter-spacing:.15em;color:rgba(255,255,255,.5);margin-top:2px}
.sidenav a{display:block;color:rgba(255,255,255,.8);text-decoration:none;font-family:"Cinzel",serif;font-size:11px;letter-spacing:.08em;padding:13px 24px;border-bottom:1px solid rgba(255,255,255,.08);transition:all .15s}
.sidenav a:hover,.sidenav a.active{background:rgba(255,255,255,.12);color:#fff;border-left:3px solid var(--or)}
.btn-logout{background:none;border:1.5px solid rgba(255,255,255,.3);color:rgba(255,255,255,.7);padding:8px 16px;font-family:"Cinzel",serif;font-size:10px;letter-spacing:.08em;cursor:pointer;width:100%}
.btn-logout:hover{background:rgba(255,255,255,.1)}
.main{margin-left:240px;padding:36px;min-height:100vh}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px}
.topbar h1{font-family:"Cormorant Garamond",serif;font-style:italic;font-size:34px;color:var(--vt)}
.topbar span{font-family:"Cinzel",serif;font-size:10px;letter-spacing:.1em;color:#999}
.card{background:#fff;padding:28px;margin-bottom:20px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.card h3{font-family:"Cinzel",serif;font-size:12px;letter-spacing:.1em;color:var(--br);margin-bottom:18px;padding-bottom:10px;border-bottom:1px solid #ede8e0}
.section{display:none}
.section.active{display:block}
table{width:100%;border-collapse:collapse;font-size:15px}
th{font-family:"Cinzel",serif;font-size:10px;letter-spacing:.08em;color:#888;padding:8px 10px;border-bottom:2px solid #ede8e0;text-align:left}
td{padding:10px 10px;border-bottom:1px solid #f5f2ec;vertical-align:middle}
tr:hover td{background:#faf8f4}
.badge-ok{background:#3B5E2B;color:#fff;font-family:"Cinzel",serif;font-size:9px;letter-spacing:.06em;padding:2px 8px}
.badge-no{background:#999;color:#fff;font-family:"Cinzel",serif;font-size:9px;letter-spacing:.06em;padding:2px 8px}
.toggle-wrap{display:flex;align-items:center;gap:10px}
.toggle{position:relative;width:44px;height:24px;cursor:pointer}
.toggle input{opacity:0;width:0;height:0;position:absolute}
.toggle-slider{position:absolute;inset:0;background:#ccc;border-radius:12px;transition:.2s}
.toggle-slider::before{content:"";position:absolute;width:18px;height:18px;left:3px;bottom:3px;background:#fff;border-radius:50%;transition:.2s}
.toggle input:checked+.toggle-slider{background:var(--vt)}
.toggle input:checked+.toggle-slider::before{transform:translateX(20px)}
.inp{width:100%;padding:10px 13px;border:1.5px solid #ddd;background:var(--cr);font-family:"EB Garamond",serif;font-size:16px;color:#444;margin-bottom:10px;outline:none}
.inp:focus{border-color:var(--vt)}
textarea.inp{min-height:80px;resize:vertical}
.inp-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.lbl-field{font-family:"Cinzel",serif;font-size:10px;letter-spacing:.12em;color:var(--br);display:block;margin-bottom:5px}
.field-group{margin-bottom:14px}
.btn-save{background:var(--vt);color:#fff;border:none;padding:11px 28px;font-family:"Cinzel",serif;font-size:11px;letter-spacing:.1em;cursor:pointer}
.btn-save:hover{background:var(--vtf)}
.btn-del{background:#cc0000;color:#fff;border:none;padding:7px 14px;font-family:"Cinzel",serif;font-size:10px;letter-spacing:.06em;cursor:pointer}
.btn-del:hover{background:#aa0000}
.btn-sm{background:var(--br);color:#fff;border:none;padding:6px 12px;font-family:"Cinzel",serif;font-size:10px;letter-spacing:.06em;cursor:pointer}
.prod-admin{background:#fff;border:1px solid #ede8e0;padding:22px;margin-bottom:14px}
.prod-admin-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.prod-admin-name{font-family:"EB Garamond",serif;font-size:20px}
.prod-ctrl{display:flex;align-items:center;gap:16px}
.remise-ctrl{display:flex;align-items:center;gap:8px;font-family:"Cinzel",serif;font-size:10px;letter-spacing:.06em;color:#666}
.notif{position:fixed;bottom:22px;right:22px;background:var(--vt);color:#fff;padding:12px 20px;font-family:"Cinzel",serif;font-size:11px;letter-spacing:.08em;z-index:9999;opacity:0;transform:translateY(8px);transition:all .25s;pointer-events:none}
.notif.on{opacity:1;transform:translateY(0)}
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:28px}
.stat-card{background:#fff;padding:22px;text-align:center;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.stat-n{font-family:"Cormorant Garamond",serif;font-size:42px;color:var(--vt);line-height:1}
.stat-l{font-family:"Cinzel",serif;font-size:10px;letter-spacing:.1em;color:#999;margin-top:4px}
.firebase-badge{background:#FFA000;color:#fff;font-family:"Cinzel",serif;font-size:9px;letter-spacing:.06em;padding:2px 8px;margin-left:8px;vertical-align:middle}
@media(max-width:768px){
  .sidebar{position:fixed;top:0;left:-260px;width:240px;height:100vh;z-index:200;transition:left .25s;box-shadow:none}
  .sidebar.open{left:0;box-shadow:6px 0 24px rgba(0,0,0,.35)}
  .sidebar-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:199;display:none}
  .sidebar-overlay.on{display:block}
  .main{margin-left:0;padding:16px;padding-top:66px}
  .stats-grid{grid-template-columns:1fr 1fr;gap:10px}
  .inp-row{grid-template-columns:1fr}
  .prod-admin-top{flex-direction:column;align-items:flex-start;gap:8px}
  .prod-ctrl{flex-wrap:wrap;gap:8px}
  .topbar{flex-direction:column;align-items:flex-start;gap:4px;margin-bottom:16px}
  .topbar h1{font-size:22px}
  .hamburger{display:flex}
}
@media(min-width:769px){
  .hamburger{display:none}
}
.hamburger{position:fixed;top:10px;left:10px;z-index:300;background:var(--br);border:none;border-radius:5px;width:46px;height:46px;cursor:pointer;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:0;box-shadow:0 2px 8px rgba(0,0,0,.25)}
.hamburger span{display:block;width:22px;height:2px;background:#fff;border-radius:2px;transition:all .2s}
.hamburger.active span:nth-child(1){transform:translateY(8px) rotate(45deg)}
.hamburger.active span:nth-child(2){opacity:0}
.hamburger.active span:nth-child(3){transform:translateY(-8px) rotate(-45deg)}
</style>
</head>
<body>
<div class="notif" id="notif"></div>
<div class="sidebar-overlay" id="sbo" onclick="closeSB()"></div>
<button class="hamburger" id="hbg" onclick="toggleSB()"><span></span><span></span><span></span></button>

<!-- LOGIN -->
<div class="login-wrap" id="login-wrap">
  <div class="login-box">
    <img src="https://i.ibb.co/C3NkLpLY/logo-officiel-saboplume.png" alt="Saboplume" style="width:120px;height:auto;object-fit:contain;margin:0 auto 18px;display:block">
    <h1>Saboplume</h1>
    <p>ESPACE ADMINISTRATEUR</p>
    <input class="linp" type="password" id="pwd" placeholder="Mot de passe" onkeydown="if(event.key==='Enter')dologin()">
    <button class="lbtn" onclick="dologin()">Se connecter</button>
    <p class="lerr" id="lerr">Mot de passe incorrect.</p>
  </div>
</div>

<!-- ADMIN -->
<div class="admin-wrap" id="admin-wrap">
  <div class="sidebar">
    <div class="sidebar-logo">
      <img src="https://i.ibb.co/C3NkLpLY/logo-officiel-saboplume.png" alt="Saboplume" style="width:80px;height:auto;object-fit:contain;display:block;margin:0 auto 12px">
      <h2 style="text-align:center">Saboplume</h2>
      <p style="text-align:center">ADMIN PANEL</p>
    </div>
    <nav class="sidenav">
      <a href="#" class="active" onclick="showSection('dashboard',this);closeSB()">üìä Tableau de bord</a>
      <a href="#" onclick="showSection('produits',this);closeSB()">üõí Produits</a>
      <a href="#" onclick="showSection('medias',this);closeSB()">üì∑ M√©dias</a>
      <a href="#" onclick="showSection('textes',this);closeSB()">üìù Textes</a>
      <a href="#" onclick="showSection('liens',this);closeSB()">üîó Liens & Contact</a>
      <a href="#" onclick="showSection('commandes',this);closeSB()">üì¶ Commandes</a>
      <a href="#" onclick="showSection('traiteur',this);closeSB()">üçΩÔ∏è Traiteur</a>
      <a href="#" onclick="showSection('locations',this);closeSB()">ü™ë Locations</a>
    </nav>
    <div style="padding:16px 24px;margin-top:20px">
      <button class="btn-logout" onclick="logout()">D√©connexion</button>
    </div>
  </div>

  <div class="main">
    <!-- DASHBOARD -->
    <div class="section active" id="sec-dashboard">
      <div class="topbar">
        <h1>Tableau de bord <span class="firebase-badge">üî• Firebase</span></h1>
        <span id="datebarre"></span>
      </div>
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-n" id="stat-cmd">‚Äî</div><div class="stat-l">COMMANDES</div></div>
        <div class="stat-card"><div class="stat-n" id="stat-trait">‚Äî</div><div class="stat-l">DEMANDES TRAITEUR</div></div>
        <div class="stat-card"><div class="stat-n" id="stat-loc">‚Äî</div><div class="stat-l">R√âSERVATIONS</div></div>
      </div>
      <div class="card">
        <h3>Derni√®res commandes</h3>
        <div id="dash-commandes"><p style="color:#aaa;font-style:italic;font-size:15px">Chargement...</p></div>
      </div>
      <div class="card" style="margin-top:16px">
        <h3>Acc√®s rapide</h3>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
          <button class="btn-sm" onclick="showSection('produits',null)">G√©rer les produits</button>
          <button class="btn-sm" onclick="showSection('commandes',null)">Voir les commandes</button>
          <button class="btn-sm" onclick="showSection('medias',null)">Changer les photos</button>
        </div>
      </div>
    </div>

    <!-- PRODUITS -->
    <div class="section" id="sec-produits">
      <div class="topbar"><h1>Gestion des Produits</h1></div>
      <div id="produits-list"><p style="color:#aaa;font-style:italic">Chargement depuis Firebase...</p></div>
      <div style="text-align:right;margin-top:10px">
        <button class="btn-save" onclick="sauvegarderProduits()">üíæ Sauvegarder tous les produits</button>
      </div>
    </div>

    <!-- MEDIAS -->
    <div class="section" id="sec-medias">
      <div class="topbar"><h1>Gestion des M√©dias</h1></div>
      <div class="card">
        <h3>Logo (Hero)</h3>
        <div class="field-group">
          <label class="lbl-field">URL du logo (imgbb)</label>
          <input class="inp" type="url" id="m-logo" placeholder="https://i.ibb.co/...">
        </div>
        <button class="btn-save" onclick="saveMedia('logo')">Mettre √† jour</button>
      </div>
      <div class="card">
        <h3>Photos Produits</h3>
        <div class="field-group"><label class="lbl-field">Oeufs ‚Äî Photo</label><input class="inp" type="url" id="m-oeuf1" placeholder="https://i.ibb.co/..."></div>
        <div class="inp-row">
          <div class="field-group"><label class="lbl-field">Volailles ‚Äî Photo 1</label><input class="inp" type="url" id="m-vol1" placeholder="https://i.ibb.co/..."></div>
          <div class="field-group"><label class="lbl-field">Volailles ‚Äî Photo 2</label><input class="inp" type="url" id="m-vol2" placeholder="https://i.ibb.co/..."></div>
        </div>
        <div class="inp-row">
          <div class="field-group"><label class="lbl-field">Caprins ‚Äî Photo 1</label><input class="inp" type="url" id="m-cap1" placeholder="https://i.ibb.co/..."></div>
          <div class="field-group"><label class="lbl-field">Caprins ‚Äî Photo 2</label><input class="inp" type="url" id="m-cap2" placeholder="https://i.ibb.co/..."></div>
        </div>
        <button class="btn-save" onclick="saveMedia('produits')">Mettre √† jour les photos produits</button>
      </div>
      <div class="card">
        <h3>Section "L'√©levage autrement"</h3>
        <div class="inp-row">
          <div class="field-group"><label class="lbl-field">Photo 1</label><input class="inp" type="url" id="m-elev1" placeholder="https://i.ibb.co/..."></div>
          <div class="field-group"><label class="lbl-field">Photo 2</label><input class="inp" type="url" id="m-elev2" placeholder="https://i.ibb.co/..."></div>
        </div>
        <button class="btn-save" onclick="saveMedia('elevage')">Mettre √† jour</button>
      </div>
      <div class="card">
        <h3>Section Traiteur</h3>
        <div class="field-group"><label class="lbl-field">Photo 1 (portrait B√©linda)</label><input class="inp" type="url" id="m-trait1" placeholder="https://i.ibb.co/..."></div>
        <div class="field-group"><label class="lbl-field">Photo 2</label><input class="inp" type="url" id="m-trait2" placeholder="https://i.ibb.co/..."></div>
        <div class="field-group"><label class="lbl-field">Photo 3</label><input class="inp" type="url" id="m-trait3" placeholder="https://i.ibb.co/..."></div>
        <button class="btn-save" onclick="saveMedia('traiteur')">Mettre √† jour</button>
      </div>
      <div class="card">
        <h3>Section Location ‚Äî Photos & Prix</h3>
        <div class="inp-row">
          <div class="field-group"><label class="lbl-field">Photo Chaises</label><input class="inp" type="url" id="m-chaises" placeholder="https://i.ibb.co/..."></div>
          <div class="field-group"><label class="lbl-field">Photo Tentes</label><input class="inp" type="url" id="m-tentes" placeholder="https://i.ibb.co/..."></div>
        </div>
        <div class="inp-row">
          <div class="field-group"><label class="lbl-field">üí∞ Prix par chaise (FCFA)</label><input class="inp" type="number" id="m-prix-chaise" placeholder="ex: 300"></div>
          <div class="field-group"><label class="lbl-field">üí∞ Prix par tente (FCFA)</label><input class="inp" type="number" id="m-prix-tente" placeholder="ex: 15000"></div>
        </div>
        <button class="btn-save" onclick="saveMedia('location')">Mettre √† jour</button>
      </div>
      <div class="card">
        <h3>Photo G√©rante (Vision & √âvolution)</h3>
        <div class="field-group"><label class="lbl-field">Photo de B√©linda Songuet</label><input class="inp" type="url" id="m-belinda" placeholder="https://i.ibb.co/..."></div>
        <button class="btn-save" onclick="saveMedia('belinda')">Mettre √† jour</button>
      </div>
      <div class="card">
        <h3>Liens PDF</h3>
        <div class="field-group"><label class="lbl-field">Lien Charte (Google Drive)</label><input class="inp" type="url" id="m-charte" placeholder="https://drive.google.com/..."></div>
        <div class="field-group"><label class="lbl-field">Lien Portfolio (Google Drive)</label><input class="inp" type="url" id="m-portfolio" placeholder="https://drive.google.com/..."></div>
        <button class="btn-save" onclick="saveMedia('pdf')">Mettre √† jour les PDF</button>
      </div>
    </div>

    <!-- TEXTES -->
    <div class="section" id="sec-textes">
      <div class="topbar"><h1>Gestion des Textes</h1></div>
      <div class="card">
        <h3>Section "Qui sommes-nous"</h3>
        <div class="field-group"><label class="lbl-field">Titre</label><input class="inp" type="text" id="txt-qui-titre" placeholder="√Ä vos c√¥t√©s pour chaque occasion"></div>
        <div class="field-group"><label class="lbl-field">Paragraphe principal</label><textarea class="inp" id="txt-qui-para" placeholder="Saboplume, votre r√©f√©rence √† Bimbo..."></textarea></div>
        <button class="btn-save" onclick="saveTexte('qui')">Sauvegarder</button>
      </div>
      <div class="card">
        <h3>Section "Vision et √âvolution"</h3>
        <div class="field-group"><label class="lbl-field">Paragraphe 1</label><textarea class="inp" id="txt-vision-p1" placeholder="Saboplume est une EURL cr√©√©e √† Bimbo..."></textarea></div>
        <div class="field-group"><label class="lbl-field">Paragraphe 2</label><textarea class="inp" id="txt-vision-p2" placeholder="Gr√¢ce √† la confiance de sa client√®le..."></textarea></div>
        <button class="btn-save" onclick="saveTexte('vision')">Sauvegarder</button>
      </div>
    </div>

    <!-- LIENS -->
    <div class="section" id="sec-liens">
      <div class="topbar"><h1>Liens & Informations de contact</h1></div>
      <div class="card">
        <h3>R√©seaux Sociaux</h3>
        <div class="field-group"><label class="lbl-field">TikTok</label><input class="inp" type="url" id="l-tiktok" placeholder="https://www.tiktok.com/@saboplume"></div>
        <div class="field-group"><label class="lbl-field">Instagram</label><input class="inp" type="url" id="l-instagram" placeholder="https://www.instagram.com/saboplume"></div>
        <div class="field-group"><label class="lbl-field">WhatsApp (lien wa.me)</label><input class="inp" type="url" id="l-whatsapp" placeholder="https://wa.me/message/..."></div>
        <div class="field-group"><label class="lbl-field">Facebook</label><input class="inp" type="url" id="l-facebook" placeholder="https://www.facebook.com/..."></div>
        <button class="btn-save" onclick="saveSection('liens')">Sauvegarder les r√©seaux</button>
      </div>
      <div class="card">
        <h3>Coordonn√©es</h3>
        <div class="field-group"><label class="lbl-field">Num√©ro de t√©l√©phone</label><input class="inp" type="tel" id="l-tel" placeholder="+236 74 22 57 57"></div>
        <div class="field-group"><label class="lbl-field">Adresse email</label><input class="inp" type="email" id="l-email" placeholder="saboplume@outlook.com"></div>
        <button class="btn-save" onclick="saveSection('coordonnees')">Sauvegarder</button>
      </div>
    </div>

    <!-- COMMANDES -->
    <div class="section" id="sec-commandes">
      <div class="topbar"><h1>Historique des Commandes</h1></div>
      <div class="card">
        <h3>Commandes re√ßues</h3>
        <div style="margin-bottom:14px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn-sm" onclick="exportCSV('commandes')">üì• Exporter CSV</button>
          <button class="btn-del" onclick="if(confirm('Effacer tout l\'historique ?')){clearHistory('commandes');}">üóë Effacer tout</button>
        </div>
        <div style="overflow-x:auto">
          <table id="table-commandes">
            <thead><tr><th>Date</th><th>Client</th><th>T√©l√©phone</th><th>Articles</th><th>Montant</th><th>R√©ception</th><th>Paiement</th><th>Action</th></tr></thead>
            <tbody id="tbody-commandes"><tr><td colspan="8" style="color:#aaa;font-style:italic;text-align:center;padding:24px">Chargement...</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- TRAITEUR -->
    <div class="section" id="sec-traiteur">
      <div class="topbar"><h1>Demandes Traiteur</h1></div>
      <div class="card">
        <h3>Demandes re√ßues</h3>
        <div style="margin-bottom:14px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn-sm" onclick="exportCSV('traiteur')">üì• Exporter CSV</button>
          <button class="btn-del" onclick="if(confirm('Effacer tout ?')){clearHistory('traiteur');}">üóë Effacer tout</button>
        </div>
        <div style="overflow-x:auto">
          <table id="table-traiteur">
            <thead><tr><th>Date</th><th>Nom</th><th>T√©l√©phone</th><th>√âv√©nement</th><th>Personnes</th><th>Date √©vt</th><th>Action</th></tr></thead>
            <tbody id="tbody-traiteur"><tr><td colspan="7" style="color:#aaa;font-style:italic;text-align:center;padding:24px">Chargement...</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- LOCATIONS -->
    <div class="section" id="sec-locations">
      <div class="topbar"><h1>R√©servations Location</h1></div>
      <div class="card">
        <h3>üí∞ Tarifs Location</h3>
        <p style="font-size:14px;color:#888;margin-bottom:16px;font-family:'EB Garamond',serif">Modifiez ici les prix affich√©s sur le site. Le total se calcule automatiquement selon la quantit√© saisie par le client.</p>
        <div class="inp-row">
          <div class="field-group">
            <label class="lbl-field">Prix par chaise (FCFA)</label>
            <input class="inp" type="number" id="loc-prix-chaise" placeholder="ex: 300" style="font-size:20px;font-weight:bold">
          </div>
          <div class="field-group">
            <label class="lbl-field">Prix par tente (FCFA)</label>
            <input class="inp" type="number" id="loc-prix-tente" placeholder="ex: 15000" style="font-size:20px;font-weight:bold">
          </div>
        </div>
        <button class="btn-save" onclick="saveTarifsLocation()">üíæ Sauvegarder les tarifs</button>
      </div>
      <div class="card">
        <h3>R√©servations re√ßues</h3>
        <div style="margin-bottom:14px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn-sm" onclick="exportCSV('locations')">üì• Exporter CSV</button>
          <button class="btn-del" onclick="if(confirm('Effacer tout ?')){clearHistory('locations');}">üóë Effacer tout</button>
        </div>
        <div style="overflow-x:auto">
          <table id="table-locations">
            <thead><tr><th>Date</th><th>Nom</th><th>T√©l√©phone</th><th>Type</th><th>Quantit√©</th><th>Lieu</th><th>Date √©vt</th><th>Action</th></tr></thead>
            <tbody id="tbody-locations"><tr><td colspan="8" style="color:#aaa;font-style:italic;text-align:center;padding:24px">Chargement...</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- FIREBASE SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, collection, getDocs, addDoc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyACg587ve8fA4VYhA6Xe022TzQ4VPR7xuk",
  authDomain: "saboplume.firebaseapp.com",
  projectId: "saboplume",
  storageBucket: "saboplume.firebasestorage.app",
  messagingSenderId: "781101005839",
  appId: "1:781101005839:web:ffbeb9f0e7793502a7377a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ======================= CONFIG =======================
const ADMIN_PASSWORD = '2027Saboplume';

const PRODUITS_DEFAULT = [
  {id:'oeuf',nom:'Palette de 30 oeufs',desc:'Fra√Æcheur assur√©e, production r√©guli√®re directement de notre √©levage.',prix:1000,dispo:true,remise:false},
  {id:'segue',nom:'Segue Kondo',desc:'Race r√©sistante, adapt√©e aux conditions locales.',prix:3500,dispo:true,remise:false},
  {id:'kondo',nom:'Kondo Ti Kodro',desc:'Vari√©t√© robuste, id√©ale pour reproduction et production.',prix:4500,dispo:true,remise:false},
  {id:'kete',nom:'Kete Ngassa',desc:'Jeune chevreau en bonne sant√©, √©lev√© dans de bonnes conditions.',prix:50000,dispo:true,remise:false},
  {id:'kota',nom:'Kota Ngassa',desc:'Ch√®vres plus d√©velopp√©es, robustes et en pleine forme.',prix:70000,dispo:true,remise:false}
];

// ======================= NOTIF =======================
function notif(m) {
  var e = document.getElementById('notif');
  e.textContent = m; e.classList.add('on');
  clearTimeout(e._t); e._t = setTimeout(function(){ e.classList.remove('on'); }, 3000);
}
window.notif = notif;

// ======================= LOGIN =======================
window.dologin = function() {
  var v = document.getElementById('pwd').value;
  if(v === ADMIN_PASSWORD) {
    document.getElementById('login-wrap').style.display = 'none';
    document.getElementById('admin-wrap').style.display = 'flex';
    init();
  } else {
    document.getElementById('lerr').style.display = 'block';
  }
};

window.logout = function() {
  document.getElementById('login-wrap').style.display = 'flex';
  document.getElementById('admin-wrap').style.display = 'none';
  document.getElementById('pwd').value = '';
};

// ======================= NAVIGATION =======================
window.showSection = function(id, el) {
  document.querySelectorAll('.section').forEach(function(s){ s.classList.remove('active'); });
  var sec = document.getElementById('sec-' + id);
  if(sec) sec.classList.add('active');
  document.querySelectorAll('.sidenav a').forEach(function(a){ a.classList.remove('active'); });
  if(el) el.classList.add('active');
  else {
    document.querySelectorAll('.sidenav a').forEach(function(a){
      if(a.getAttribute('onclick') && a.getAttribute('onclick').indexOf("'" + id + "'") >= 0) a.classList.add('active');
    });
  }
  if(id === 'commandes') renderTable('commandes');
  if(id === 'traiteur') renderTable('traiteur');
  if(id === 'locations') { renderTable('locations'); loadTarifsLocation(); }
  if(id === 'dashboard') renderDashboard();
};

// ======================= FIREBASE HELPERS =======================
async function fbGet(collection_name, doc_id) {
  try {
    const ref = doc(db, collection_name, doc_id);
    const snap = await getDoc(ref);
    return snap.exists() ? snap.data() : null;
  } catch(e) { console.error(e); return null; }
}

async function fbSet(collection_name, doc_id, data) {
  try {
    await setDoc(doc(db, collection_name, doc_id), data);
    return true;
  } catch(e) { console.error(e); return false; }
}

async function fbGetCollection(col) {
  try {
    const snap = await getDocs(collection(db, col));
    var results = [];
    snap.forEach(function(d){ results.push({...d.data(), _id: d.id}); });
    return results;
  } catch(e) { console.error(e); return []; }
}

async function fbDeleteDoc(col, id) {
  try {
    await deleteDoc(doc(db, col, id));
    return true;
  } catch(e) { console.error(e); return false; }
}

// ======================= PRODUITS =======================
var produitsData = [];

async function loadProduits() {
  var data = await fbGet('config', 'produits');
  produitsData = (data && data.liste) ? data.liste : PRODUITS_DEFAULT;
  renderProduits();
}

function remiseOptions(idx, remActuelle) {
  return [0,5,10,25].map(function(v){
    var sel = (remActuelle === v);
    return '<label style="cursor:pointer;padding:5px 11px;border:1.5px solid '+(sel?'var(--br)':'#ccc')+';font-family:\'Cinzel\',serif;font-size:10px;letter-spacing:.06em;background:'+(sel?'var(--br)':'#fff')+';color:'+(sel?'#fff':'#666')+';display:inline-block;margin:2px">'
      + '<input type="radio" name="rem'+idx+'" value="'+v+'" '+(sel?'checked':'')+' onchange="updateProduit('+idx+')" style="display:none">'+v+'%</label>';
  }).join('');
}

function renderProduits() {
  var html = '';
  produitsData.forEach(function(p, idx) {
    var rem = (typeof p.remise === 'number') ? p.remise : (p.remise ? 5 : 0);
    var prixApres = rem > 0 ? Math.round(p.prix * (1 - rem/100)) : 0;
    html += '<div class="prod-admin">'
      + '<div class="prod-admin-top">'
      + '<span class="prod-admin-name">' + p.nom + '</span>'
      + '<div class="prod-ctrl">'
      + '<div class="remise-ctrl"><span style="font-family:\'Cinzel\',serif;font-size:10px;color:#999;margin-right:6px">REMISE :</span>' + remiseOptions(idx, rem) + '</div>'
      + '<div class="toggle-wrap"><label class="toggle"><input type="checkbox" id="dispo-' + idx + '" ' + (p.dispo ? 'checked' : '') + ' onchange="updateProduit(' + idx + ')"><span class="toggle-slider"></span></label>'
      + '<span style="font-family:\'Cinzel\',serif;font-size:10px;letter-spacing:.06em;color:#666" id="dlbl-' + idx + '">' + (p.dispo ? 'Disponible' : 'Indisponible') + '</span></div>'
      + '</div></div>'
      + '<div class="inp-row">'
      + '<div class="field-group"><label class="lbl-field">Nom du produit</label><input class="inp" type="text" id="pnom-' + idx + '" value="' + p.nom + '" style="margin-bottom:0"></div>'
      + '<div class="field-group"><label class="lbl-field">Prix (FCFA)</label><input class="inp" type="number" id="pprix-' + idx + '" value="' + p.prix + '" style="margin-bottom:0"></div>'
      + '</div>'
      + '<div class="field-group" style="margin-top:10px"><label class="lbl-field">Description</label>'
      + '<textarea class="inp" id="pdesc-' + idx + '" style="min-height:55px;margin-bottom:0">' + p.desc + '</textarea>'
      + '</div>'
      + (rem > 0 ? '<div style="margin-top:8px;padding:8px 12px;background:#eef2e8;font-size:14px;color:var(--vt)">Remise <strong>' + rem + '%</strong> \u2192 <strong>' + prixApres.toLocaleString('fr-FR') + ' FCFA</strong> <span style="color:#bbb;text-decoration:line-through;font-size:13px">' + p.prix.toLocaleString('fr-FR') + ' FCFA</span></div>' : '')
      + '</div>';
  });
  document.getElementById('produits-list').innerHTML = html;
}

window.updateProduit = function(idx) {
  var d = document.getElementById('dispo-' + idx).checked;
  var rEl = document.querySelector('input[name="rem' + idx + '"]:checked');
  var r = rEl ? parseInt(rEl.value) : 0;
  produitsData[idx].dispo = d;
  produitsData[idx].remise = r;
  document.getElementById('dlbl-' + idx).textContent = d ? 'Disponible' : 'Indisponible';
  renderProduits();
};

window.sauvegarderProduits = async function() {
  produitsData.forEach(function(p, idx) {
    p.nom = document.getElementById('pnom-' + idx).value.trim() || p.nom;
    p.prix = parseInt(document.getElementById('pprix-' + idx).value) || p.prix;
    p.desc = document.getElementById('pdesc-' + idx).value.trim() || p.desc;
    p.dispo = document.getElementById('dispo-' + idx).checked;
    var rEl = document.querySelector('input[name="rem' + idx + '"]:checked');
    p.remise = rEl ? parseInt(rEl.value) : 0;
  });
  var ok = await fbSet('config', 'produits', {liste: produitsData});
  if(ok) { notif('Produits sauvegard\u00e9s dans Firebase \u2713'); renderProduits(); }
  else notif('Erreur de sauvegarde \u2717');
};

// ======================= MEDIAS =======================
window.saveMedia = async function(type) {
  var data = await fbGet('config', 'medias') || {};
  if(type === 'logo') { data.logo = document.getElementById('m-logo').value.trim(); }
  if(type === 'produits') {
    data.oeuf1 = document.getElementById('m-oeuf1').value.trim();
    data.vol1 = document.getElementById('m-vol1').value.trim();
    data.vol2 = document.getElementById('m-vol2').value.trim();
    data.cap1 = document.getElementById('m-cap1').value.trim();
    data.cap2 = document.getElementById('m-cap2').value.trim();
  }
  if(type === 'elevage') { data.elev1 = document.getElementById('m-elev1').value.trim(); data.elev2 = document.getElementById('m-elev2').value.trim(); }
  if(type === 'traiteur') { data.trait1 = document.getElementById('m-trait1').value.trim(); data.trait2 = document.getElementById('m-trait2').value.trim(); data.trait3 = document.getElementById('m-trait3').value.trim(); }
  if(type === 'location') { data.chaises = document.getElementById('m-chaises').value.trim(); data.tentes = document.getElementById('m-tentes').value.trim(); var pc=document.getElementById('m-prix-chaise').value.trim(); var pt=document.getElementById('m-prix-tente').value.trim(); if(pc)data.prixChaise=parseInt(pc); if(pt)data.prixTente=parseInt(pt); }
  if(type === 'belinda') { data.belinda = document.getElementById('m-belinda').value.trim(); }
  if(type === 'pdf') { data.charte = document.getElementById('m-charte').value.trim(); data.portfolio = document.getElementById('m-portfolio').value.trim(); }
  var ok = await fbSet('config', 'medias', data);
  if(ok) notif('M√©dias sauvegard√©s dans Firebase ‚úì ‚Äî Le site se met √† jour automatiquement.');
  else notif('Erreur de sauvegarde ‚úó');
};

async function loadMediaFields() {
  var d = await fbGet('config', 'medias');
  if(!d) return;
  var map = {logo:'m-logo',oeuf1:'m-oeuf1',vol1:'m-vol1',vol2:'m-vol2',cap1:'m-cap1',cap2:'m-cap2',elev1:'m-elev1',elev2:'m-elev2',trait1:'m-trait1',trait2:'m-trait2',trait3:'m-trait3',chaises:'m-chaises',tentes:'m-tentes',belinda:'m-belinda',charte:'m-charte',portfolio:'m-portfolio'};
  Object.keys(map).forEach(function(k){ if(d[k]) document.getElementById(map[k]).value = d[k]; });
  if(d.prixChaise){ document.getElementById('m-prix-chaise').value = d.prixChaise; document.getElementById('loc-prix-chaise').value = d.prixChaise; }
  if(d.prixTente){ document.getElementById('m-prix-tente').value = d.prixTente; document.getElementById('loc-prix-tente').value = d.prixTente; }
}

async function loadTarifsLocation() {
  var d = await fbGet('config', 'medias');
  if(!d) return;
  if(d.prixChaise) document.getElementById('loc-prix-chaise').value = d.prixChaise;
  if(d.prixTente) document.getElementById('loc-prix-tente').value = d.prixTente;
}

window.saveTarifsLocation = async function() {
  var pc = document.getElementById('loc-prix-chaise').value.trim();
  var pt = document.getElementById('loc-prix-tente').value.trim();
  if(!pc && !pt){ notif('Entrez au moins un prix √† sauvegarder.'); return; }
  var data = await fbGet('config', 'medias') || {};
  if(pc){ data.prixChaise = parseInt(pc); document.getElementById('m-prix-chaise').value = pc; }
  if(pt){ data.prixTente = parseInt(pt); document.getElementById('m-prix-tente').value = pt; }
  var ok = await fbSet('config', 'medias', data);
  if(ok) notif('Tarifs sauvegard√©s ‚úì ‚Äî Chaise : ' + (pc||'‚Äî') + ' FCFA ¬∑ Tente : ' + (pt||'‚Äî') + ' FCFA');
  else notif('Erreur de sauvegarde ‚úó');
};

// ======================= TEXTES =======================
window.saveTexte = async function(type) {
  var data = await fbGet('config', 'textes') || {};
  if(type === 'qui') {
    data.quiTitre = document.getElementById('txt-qui-titre').value.trim();
    data.quiPara = document.getElementById('txt-qui-para').value.trim();
  }
  if(type === 'vision') {
    data.visionP1 = document.getElementById('txt-vision-p1').value.trim();
    data.visionP2 = document.getElementById('txt-vision-p2').value.trim();
  }
  var ok = await fbSet('config', 'textes', data);
  if(ok) notif('Texte sauvegard√© dans Firebase ‚úì');
  else notif('Erreur de sauvegarde ‚úó');
};

async function loadTexteFields() {
  var d = await fbGet('config', 'textes');
  if(!d) return;
  if(d.quiTitre) document.getElementById('txt-qui-titre').value = d.quiTitre;
  if(d.quiPara) document.getElementById('txt-qui-para').value = d.quiPara;
  if(d.visionP1) document.getElementById('txt-vision-p1').value = d.visionP1;
  if(d.visionP2) document.getElementById('txt-vision-p2').value = d.visionP2;
}

// ======================= LIENS =======================
window.saveSection = async function(type) {
  var data = await fbGet('config', 'liens') || {};
  if(type === 'liens') {
    data.tiktok = document.getElementById('l-tiktok').value.trim();
    data.instagram = document.getElementById('l-instagram').value.trim();
    data.whatsapp = document.getElementById('l-whatsapp').value.trim();
    data.facebook = document.getElementById('l-facebook').value.trim();
  }
  if(type === 'coordonnees') {
    data.tel = document.getElementById('l-tel').value.trim();
    data.email = document.getElementById('l-email').value.trim();
  }
  var ok = await fbSet('config', 'liens', data);
  if(ok) notif('Informations sauvegard√©es dans Firebase ‚úì');
  else notif('Erreur de sauvegarde ‚úó');
};

async function loadLiensFields() {
  var d = await fbGet('config', 'liens');
  if(!d) return;
  if(d.tiktok) document.getElementById('l-tiktok').value = d.tiktok;
  if(d.instagram) document.getElementById('l-instagram').value = d.instagram;
  if(d.whatsapp) document.getElementById('l-whatsapp').value = d.whatsapp;
  if(d.facebook) document.getElementById('l-facebook').value = d.facebook;
  if(d.tel) document.getElementById('l-tel').value = d.tel;
  if(d.email) document.getElementById('l-email').value = d.email;
}

// ======================= TABLES COMMANDES/TRAITEUR/LOCATIONS =======================
var cacheData = {commandes:[], traiteur:[], locations:[]};

window.renderTable = async function(type) {
  var tbody = document.getElementById('tbody-' + type);
  tbody.innerHTML = '<tr><td colspan="8" style="color:#aaa;font-style:italic;text-align:center;padding:24px">Chargement...</td></tr>';
  var data = await fbGetCollection(type);
  cacheData[type] = data;
  var cols = {commandes:8, traiteur:7, locations:8}[type] || 6;
  if(!data.length) {
    tbody.innerHTML = '<tr><td colspan="' + cols + '" style="color:#aaa;font-style:italic;text-align:center;padding:24px">Aucun enregistrement.</td></tr>';
    return;
  }
  // Trier par date d√©croissante
  data.sort(function(a,b){ return (b.date||'').localeCompare(a.date||''); });
  var html = '';
  data.forEach(function(row) {
    html += '<tr>';
    if(type === 'commandes') {
      html += '<td>' + (row.date||'') + '</td><td>' + (row.client||'') + '</td><td>' + (row.tel||'') + '</td><td style="max-width:200px;font-size:13px">' + (row.articles||'') + '</td><td><strong>' + (row.montant||'') + '</strong></td><td>' + (row.reception||'') + '</td><td>' + (row.paiement||'') + '</td>';
    }
    if(type === 'traiteur') {
      html += '<td>' + (row.date||'') + '</td><td>' + (row.nom||'') + '</td><td>' + (row.tel||'') + '</td><td>' + (row.evenement||'') + '</td><td>' + (row.personnes||'') + '</td><td>' + (row.dateEvt||'') + '</td>';
    }
    if(type === 'locations') {
      html += '<td>' + (row.date||'') + '</td><td>' + (row.nom||'') + '</td><td>' + (row.tel||'') + '</td><td>' + (row.type||'') + '</td><td>' + (row.quantite||'') + '</td><td>' + (row.lieu||'') + '</td><td>' + (row.dateEvt||'') + '</td>';
    }
    html += '<td><button class="btn-del" onclick="deleteRow(\'' + type + '\',\'' + row._id + '\')">‚úï</button></td></tr>';
  });
  tbody.innerHTML = html;
};

window.deleteRow = async function(type, id) {
  if(!confirm('Supprimer cet enregistrement ?')) return;
  var ok = await fbDeleteDoc(type, id);
  if(ok) { notif('Supprim√© ‚úì'); renderTable(type); renderDashboard(); }
  else notif('Erreur de suppression ‚úó');
};

window.clearHistory = async function(type) {
  var data = await fbGetCollection(type);
  for(var d of data) { await fbDeleteDoc(type, d._id); }
  notif('Historique effac√© ‚úì');
  renderTable(type);
  renderDashboard();
};

window.exportCSV = async function(type) {
  var data = await fbGetCollection(type);
  if(!data.length){ notif('Aucun enregistrement √† exporter.'); return; }
  var keys = Object.keys(data[0]).filter(function(k){ return k !== '_id'; });
  var csv = keys.join(';') + '\n';
  data.forEach(function(r){ csv += keys.map(function(k){ return '"' + (r[k]||'').toString().replace(/"/g,'""') + '"'; }).join(';') + '\n'; });
  var blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a'); a.href = url; a.download = 'saboplume_' + type + '_' + new Date().toISOString().slice(0,10) + '.csv'; a.click();
  URL.revokeObjectURL(url);
};

// ======================= DASHBOARD =======================
async function renderDashboard() {
  var cmd = await fbGetCollection('commandes');
  var trait = await fbGetCollection('traiteur');
  var loc = await fbGetCollection('locations');
  document.getElementById('stat-cmd').textContent = cmd.length;
  document.getElementById('stat-trait').textContent = trait.length;
  document.getElementById('stat-loc').textContent = loc.length;
  var dc = document.getElementById('dash-commandes');
  if(!cmd.length){ dc.innerHTML = '<p style="color:#aaa;font-style:italic;font-size:15px">Aucune commande pour le moment.</p>'; return; }
  cmd.sort(function(a,b){ return (b.date||'').localeCompare(a.date||''); });
  var last = cmd.slice(0, 5);
  var html = '<div style="overflow-x:auto"><table><thead><tr><th>Date</th><th>Client</th><th>Montant</th><th>Paiement</th></tr></thead><tbody>';
  last.forEach(function(r){
    html += '<tr><td>' + (r.date||'') + '</td><td>' + (r.client||'') + '</td><td><strong>' + (r.montant||'') + '</strong></td><td>' + (r.paiement||'') + '</td></tr>';
  });
  html += '</tbody></table></div>';
  dc.innerHTML = html;
}

// ======================= INIT =======================
async function init() {
  document.getElementById('datebarre').textContent = new Date().toLocaleDateString('fr-FR',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  notif('Connexion √† Firebase...');
  await Promise.all([
    loadProduits(),
    loadMediaFields(),
    loadTexteFields(),
    loadLiensFields(),
    renderDashboard()
  ]);
  notif('Firebase connect√© ‚úì');
}

// ======================= MOBILE SIDEBAR =======================
window.toggleSB = function() {
  var sb = document.querySelector('.sidebar');
  var ov = document.getElementById('sbo');
  var hb = document.getElementById('hbg');
  var open = sb.classList.toggle('open');
  ov.classList.toggle('on', open);
  hb.classList.toggle('active', open);
};
window.closeSB = function() {
  document.querySelector('.sidebar').classList.remove('open');
  document.getElementById('sbo').classList.remove('on');
  document.getElementById('hbg').classList.remove('active');
};

</script>
</body>
</html>
